<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é—®ç­”ç³»ç»Ÿ - ä»¥é«˜è´¨é‡å‘å±•å’Œé«˜æ•ˆèƒ½æ²»ç†æ¨è¿›ä¸­å›½å¼ç°ä»£åŒ–</title>
  <style>
    :root {
      --bg-color: #f4f7f9;
      --card-bg-color: #ffffff;
      --text-color: #333333;
      --title-color: #1a237e;
      --primary-color: #3f51b5;
      --primary-hover-color: #303f9f;
      --disabled-color: #b0bec5;
      --border-color: #e0e0e0;
      --option-hover-bg: #f1f3f5;
      --selected-bg: #e8eaf6;
      --selected-border: #3f51b5;
      --correct-bg: #e8f5e9;
      --correct-border: #4caf50;
      --incorrect-bg: #ffebee;
      --incorrect-border: #f44336;
      --shadow: 0 10px 30px rgba(0, 0, 0, 0.07);
      --material-bg: #fafafa;
      --material-border: var(--primary-color);
    }
    html[data-theme='dark'] {
      --bg-color: #121212;
      --card-bg-color: #1e1e1e;
      --text-color: #e0e0e0;
      --title-color: #9fa8da;
      --primary-color: #7986cb;
      --primary-hover-color: #9fa8da;
      --disabled-color: #424242;
      --border-color: #424242;
      --option-hover-bg: #2a2a2a;
      --selected-bg: #2a2a2a;
      --selected-border: #7986cb;
      --correct-bg: #1a331a;
      --correct-border: #66bb6a;
      --incorrect-bg: #4d1a1a;
      --incorrect-border: #ef5350;
      --shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      --material-bg: #2a2a2a;
      --material-border: var(--primary-color);
    }
    body {
      font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
      background-color: var(--bg-color); color: var(--text-color); margin: 0; padding: 20px;
      display: flex; justify-content: center; align-items: flex-start; min-height: 100vh;
      transition: background-color 0.3s ease, color 0.3s ease;
    }
    #app {
      width: 100%; max-width: 1200px; background-color: var(--card-bg-color); border-radius: 12px;
      box-shadow: var(--shadow); transition: all 0.3s ease; position: relative;
    }
    .main-content { padding: 30px 40px; }
    .theme-switcher {
      position: absolute; top: 20px; right: 20px; width: 40px; height: 40px; border-radius: 50%;
      background-color: var(--option-hover-bg); border: 1px solid var(--border-color); color: var(--text-color);
      font-size: 20px; display: flex; justify-content: center; align-items: center; cursor: pointer;
      transition: all 0.3s ease; z-index: 100;
    }
    .theme-switcher:hover { transform: scale(1.1) rotate(15deg); }
    h1, h2, h3 { color: var(--title-color); text-align: center; }
    h1 { font-size: 1.8em; margin-bottom: 10px; }
    h2 { font-size: 1.5em; margin-bottom: 30px; border-bottom: 2px solid var(--primary-color); padding-bottom: 15px; }
    .question-header { font-size: 1.25em; font-weight: 600; margin-bottom: 25px; line-height: 1.6; }
    .question-type-badge { font-size: 0.8em; font-weight: normal; color: var(--primary-color); border: 1px solid var(--primary-color); padding: 2px 8px; border-radius: 4px; margin-left: 10px; }
    .options { display: flex; flex-direction: column; gap: 15px; }
    .option {
      padding: 15px 20px; border: 1px solid var(--border-color); border-radius: 8px; cursor: pointer;
      transition: all 0.2s ease-in-out; display: flex; align-items: center;
    }
    .option:hover { background-color: var(--option-hover-bg); transform: translateY(-2px); }
    .option.selected { background-color: var(--selected-bg); border-color: var(--selected-border); }
    .option.correct { background-color: var(--correct-bg); border-color: var(--correct-border); color: var(--text-color); }
    .option.incorrect { background-color: var(--incorrect-bg); border-color: var(--incorrect-border); color: var(--text-color); }
    .controls { margin-top: 30px; text-align: center; display: flex; gap: 20px; justify-content: center; }
    button {
      padding: 12px 35px; font-size: 1.1em; font-weight: 500; border: none; border-radius: 8px;
      background-color: var(--primary-color); color: #fff; cursor: pointer; transition: all 0.2s;
    }
    button:hover { background-color: var(--primary-hover-color); transform: translateY(-2px); box-shadow: 0 4px 15px rgba(0,0,0,0.1);}
    button:disabled { background-color: var(--disabled-color); cursor: not-allowed; transform: none; box-shadow: none; }
    button.secondary { background-color: var(--option-hover-bg); color: var(--text-color); border: 1px solid var(--border-color); }
    button.secondary:hover { background-color: var(--border-color); }
    .material {
      margin-top: 30px; padding: 25px; background-color: var(--material-bg);
      border-left: 5px solid var(--material-border); border-radius: 5px;
    }
    .material h3 { margin-top: 0; font-size: 1.3em; }
    .material p { line-height: 1.9; font-size: 1.05em; text-align: left;}
    .material-image { max-width: 100%; border-radius: 8px; margin-top: 15px; }
    .level-selection-container { text-align: center; }
    .level-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px; margin-top: 30px; }
    .level-card {
      padding: 20px; border: 1px solid var(--border-color); border-radius: 8px; cursor: pointer;
      transition: all 0.3s ease; background-color: var(--card-bg-color);
    }
    .level-card:hover { transform: translateY(-5px); box-shadow: var(--shadow); border-color: var(--primary-color); }
    .level-card h3 { font-size: 1.2em; margin-top: 0; margin-bottom: 10px; }
    .level-transition {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background-color: var(--bg-color); z-index: 999;
      display: flex; justify-content: center; align-items: center;
      animation: level-fade-in-out 2.5s forwards;
    }
    .level-transition-title { font-size: 3em; color: var(--title-color); opacity: 0; animation: title-appear 1.5s 0.5s forwards; }
    @keyframes level-fade-in-out { 0% { opacity: 0; } 20% { opacity: 1; } 80% { opacity: 1; } 100% { opacity: 0; } }
    @keyframes title-appear { 0% { opacity: 0; transform: translateY(20px); } 100% { opacity: 1; transform: translateY(0); } }
    .fade-enter-active, .fade-leave-active { transition: opacity 0.5s ease; }
    .fade-enter-from, .fade-leave-to { opacity: 0; }
    .quiz-layout { display: flex; }
    .quiz-main { flex: 1; transition: all 0.3s ease; }
    .question-nav {
      width: 250px; padding: 20px; border-left: 1px solid var(--border-color);
      height: 80vh; overflow-y: auto; transition: all 0.3s ease;
    }
    .question-nav.collapsed { width: 0; padding: 0; border-left: none; overflow: hidden; }
    .nav-toggle {
      position: absolute; top: 50%; right: 0; transform: translateY(-50%);
      width: 25px; height: 100px; background-color: var(--primary-color);
      color: white; display: flex; justify-content: center; align-items: center;
      cursor: pointer; border-radius: 8px 0 0 8px; z-index: 50;
    }
    .question-nav.collapsed + .nav-toggle { right: -25px; }
    .question-nav h3 { font-size: 1.2em; margin-top: 0; margin-bottom: 15px; }
    .nav-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; }
    .nav-item {
      width: 35px; height: 35px; border-radius: 50%; display: flex; justify-content: center; align-items: center;
      cursor: pointer; transition: all 0.2s ease; border: 1px solid var(--border-color);
      background-color: var(--card-bg-color);
    }
    .nav-item:hover { background-color: var(--option-hover-bg); }
    .nav-item.active { background-color: var(--primary-color); color: #fff; border-color: var(--primary-color); }
    .nav-item.answered-correct { background-color: var(--correct-bg); border-color: var(--correct-border); }
    .nav-item.answered-incorrect { background-color: var(--incorrect-bg); border-color: var(--incorrect-border); }
    .score-display { text-align: center; margin: 20px 0; font-size: 1.2em; }
  </style>
</head>
<body>

<div id="app">
  <div class="theme-switcher" @click="toggleTheme" :title="'åˆ‡æ¢ä¸»é¢˜'">{{ theme === 'light' ? 'ğŸŒ™' : 'â˜€ï¸' }}</div>

  <div v-if="showLevelTransition" class="level-transition">
    <h2 class="level-transition-title">{{ quizData[currentLevelIndex].title }}</h2>
  </div>

  <transition name="fade" mode="out-in">
    <div :key="currentView" class="main-content">
      <div v-if="currentView === 'start'">
        <h1>ä¸­å›½å¼ç°ä»£åŒ–é—®ç­”æŒ‘æˆ˜</h1>
        <div style="text-align: center; padding: 40px 0;">
          <p style="font-size: 1.2em; margin-bottom: 30px;">å‡†å¤‡å¥½é€šè¿‡é—®ç­”æ·±å…¥äº†è§£â€œé«˜è´¨é‡å‘å±•ä¸é«˜æ•ˆèƒ½æ²»ç†â€äº†å—ï¼Ÿ</p>
          <button @click="startChallenge">å¼€å§‹æŒ‘æˆ˜</button>
        </div>
      </div>
      
      <div v-else-if="currentView === 'levelSelection'" class="level-selection-container">
        <h2>è¯·é€‰æ‹©æŒ‘æˆ˜å…³å¡</h2>
        <div class="level-grid">
          <div v-for="(level, index) in quizData" :key="index" class="level-card" @click="selectLevel(index)">
            <h3>{{ level.title }}</h3>
            <p>{{ level.questions.length }} é“é¢˜ç›®</p>
            <p>æœ¬å…³å¾—åˆ†: {{ levelScores[index] || 0 }} / {{ level.questions.length }}</p>
          </div>
        </div>
        <div class="controls">
           <button class="secondary" @click="exitChallenge">é€€å‡ºæŒ‘æˆ˜</button>
        </div>
      </div>

      <div v-else-if="currentView === 'quiz'" class="quiz-layout">
        <div class="quiz-main">
          <h2>{{ currentLevel.title }}</h2>
          <div class="quiz-container">
            <div class="question-header">
              <span>é—®é¢˜ {{ currentQuestion.absoluteIndex + 1 }} / {{ totalQuestions }}:</span>
              <span class="question-type-badge">{{ currentQuestion.type === 'single' ? 'å•é€‰' : 'å¤šé€‰' }}</span>
              <p v-html="currentQuestion.question"></p>
            </div>
            <div class="options">
              <div v-for="(option, index) in currentQuestion.options" :key="index" class="option" :class="getOptionClass(option)" @click="selectOption(option)">
                <input :type="currentQuestion.type === 'single' ? 'radio' : 'checkbox'" :name="'q' + currentQuestionIndex" :value="option" :checked="isSelected(option)" style="pointer-events: none; margin-right: 15px; accent-color: var(--primary-color);"><label v-html="option"></label>
              </div>
            </div>
            <div class="controls">
              <button class="secondary" @click="currentView = 'levelSelection'">è¿”å›é€‰å…³</button>
              <button v-if="!answered" @click="submitAnswer" :disabled="!isAnswerSelected">æäº¤ç­”æ¡ˆ</button>
              <button v-if="answered" @click="nextQuestion">ä¸‹ä¸€é¢˜</button>
            </div>
            <div v-if="answered" class="material">
              <h3>{{ currentQuestion.material.title }}</h3>
                <template v-if="currentQuestion.absoluteIndex === 46">
                  <img src="image/47.png" class="material-image" />
                  <img src="image/47(2).png" class="material-image" />
                </template>
                <template v-else>
                  <img :src="'image/' + (currentQuestion.absoluteIndex + 1) + '.png'" class="material-image" />
                </template>
              <p v-html="currentQuestion.material.content"></p>
            </div>
          </div>
        </div>
        <div class="question-nav" :class="{ collapsed: navCollapsed }">
          <h3>é¢˜ç›®å¯¼èˆª</h3>
          <div class="nav-grid">
            <div v-for="(q, index) in flatQuestions" :key="index" class="nav-item" :class="getNavClass(q.absoluteIndex)" @click="jumpToQuestion(q.absoluteIndex)">
              {{ index + 1 }}
            </div>
          </div>
        </div>
        <div class="nav-toggle" @click="navCollapsed = !navCollapsed">{{ navCollapsed ? 'Â«' : 'Â»' }}</div>
      </div>

      <div v-else-if="currentView === 'end'">
        <h2>æ­å–œä½ ï¼Œå·²å®Œæˆæ‰€æœ‰æŒ‘æˆ˜ï¼</h2>
        <div class="score-display">
          <p>æ€»å¾—åˆ†: {{ score }} / {{ totalQuestions }}</p>
          <div v-for="(level, index) in quizData">
            {{ level.title }}: {{ levelScores[index] || 0 }} / {{ level.questions.length }}
          </div>
        </div>
        <div class="controls">
          <button @click="startChallenge">é‡æ–°æŒ‘æˆ˜</button>
          <button class="secondary" @click="currentView = 'levelSelection'">è¿”å›é€‰å…³</button>
        </div>
      </div>
    </div>
  </transition>
</div>

<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script src="data/level1.js"></script>
<script src="data/level2.js"></script>
<script src="data/level3.js"></script>
<script src="data/level4.js"></script>
<script src="data/level5.js"></script>
<script>
  const { createApp } = Vue;
  createApp({
    data() {
      return {
        quizData: [level1Data, level2Data, level3Data, level4Data, level5Data],
        currentView: 'start', currentLevelIndex: 0, currentQuestionIndex: 0,
        userAnswer: [], answered: false, score: 0, theme: 'light',
        showLevelTransition: false, navCollapsed: false,
        userAnswers: {}, levelScores: {},
      };
    },
    computed: {
      flatQuestions() {
        let absoluteIndex = 0;
        return this.quizData.flatMap((level, levelIndex) => 
          level.questions.map((question, questionIndex) => ({
            ...question, levelIndex, questionIndex, absoluteIndex: absoluteIndex++
          }))
        );
      },
      currentQuestion() { return this.flatQuestions.find(q => q.levelIndex === this.currentLevelIndex && q.questionIndex === this.currentQuestionIndex); },
      currentLevel() { return this.quizData[this.currentLevelIndex]; },
      totalQuestions() { return this.flatQuestions.length; },
      isAnswerSelected() { return this.userAnswer.length > 0; }
    },
    watch: {
      theme(newTheme) {
        document.documentElement.setAttribute('data-theme', newTheme);
        localStorage.setItem('quizTheme', newTheme);
      }
    },
    mounted() {
      const savedTheme = localStorage.getItem('quizTheme');
      if (savedTheme) { this.theme = savedTheme; } 
      else {
        const userPrefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        this.theme = userPrefersDark ? 'dark' : 'light';
      }
    },
    methods: {
      toggleTheme() { this.theme = this.theme === 'light' ? 'dark' : 'light'; },
      startChallenge() {
        this.score = 0;
        this.userAnswers = {};
        this.levelScores = {};
        this.currentLevelIndex = 0;
        this.currentQuestionIndex = 0;
        this.resetQuestionStateAndAnswer();
        this.currentView = 'levelSelection';
      },
      selectLevel(levelIndex) {
        this.currentLevelIndex = levelIndex;
        this.currentQuestionIndex = 0;
        this.resetQuestionStateAndAnswer();
        this.showLevelTransition = true;
        setTimeout(() => {
          this.currentView = 'quiz';
          setTimeout(() => { this.showLevelTransition = false; }, 2500);
        }, 100);
      },
      jumpToQuestion(absoluteIndex) {
        const targetQuestion = this.flatQuestions[absoluteIndex];
        if (targetQuestion) {
          this.currentLevelIndex = targetQuestion.levelIndex;
          this.currentQuestionIndex = targetQuestion.questionIndex;
          this.resetQuestionStateAndAnswer();
          const savedAnswer = this.userAnswers[absoluteIndex];
          if (savedAnswer) {
            this.userAnswer = savedAnswer.answer;
            this.answered = true;
          }
        }
      },
      selectOption(option) {
        if (this.answered) return;
        if (this.currentQuestion.type === 'single') { this.userAnswer = [option]; } 
        else {
          const index = this.userAnswer.indexOf(option);
          if (index > -1) { this.userAnswer.splice(index, 1); } 
          else { this.userAnswer.push(option); }
        }
      },
      isSelected(option) { return this.userAnswer.includes(option); },
      submitAnswer() {
        this.answered = true;
        let isCorrect = false;
        if (this.currentQuestion.type === 'single') {
          isCorrect = this.userAnswer[0] === this.currentQuestion.answer[0];
        } else {
          const userAnswerSet = new Set(this.userAnswer);
          const correctAnswerSet = new Set(this.currentQuestion.answer);
          isCorrect = userAnswerSet.size === correctAnswerSet.size && [...userAnswerSet].every(x => correctAnswerSet.has(x));
        }
        this.userAnswers[this.currentQuestion.absoluteIndex] = { answer: [...this.userAnswer], isCorrect };
        this.updateScores();
      },
      updateScores() {
        this.score = 0;
        this.levelScores = {};
        for (const key in this.userAnswers) {
          if (this.userAnswers[key].isCorrect) this.score++;
          const question = this.flatQuestions[key];
          if (question) {
            this.levelScores[question.levelIndex] = (this.levelScores[question.levelIndex] || 0) + (this.userAnswers[key].isCorrect ? 1 : 0);
          }
        }
      },
      nextQuestion() {
        const nextAbsoluteIndex = this.currentQuestion.absoluteIndex + 1;
        if (nextAbsoluteIndex < this.totalQuestions) { this.jumpToQuestion(nextAbsoluteIndex); } 
        else { this.currentView = 'end'; }
      },
      getOptionClass(option) {
        if (!this.answered) return { selected: this.isSelected(option) };
        const isCorrectAnswer = this.currentQuestion.answer.includes(option);
        if (isCorrectAnswer) return 'correct';
        if (this.isSelected(option) && !isCorrectAnswer) return 'incorrect';
        return '';
      },
      getNavClass(absoluteIndex) {
        const answerInfo = this.userAnswers[absoluteIndex];
        let classes = { active: absoluteIndex === this.currentQuestion.absoluteIndex };
        if (answerInfo) {
          classes['answered-correct'] = answerInfo.isCorrect;
          classes['answered-incorrect'] = !answerInfo.isCorrect;
        }
        return classes;
      },
      resetQuestionStateAndAnswer() {
        this.answered = false;
        this.userAnswer = [];
      },
      exitChallenge() {
        this.currentView = 'start';
      }
    }
  }).mount('#app');
</script>
</body>
</html>